---
import type { PartnersTickerItemFields } from '@/types/__generated__/types';
import { getDefaultProps, onImageError } from '@/lib/error';
import { Image } from 'astro:assets';

export type PartnerTickerItemProp = {
	name: string;
	brandImg: string;
	link: string;
	title: string;
};

interface Props {
	partnerTickerItems: PartnerTickerItemProp[];
}

export function createProps(wpContent: PartnersTickerItemFields[]): Props {
	if (!wpContent?.length) {
		return getDefaultProps<Props>('PartnersTicker createProps', Astro);
	}

	const partnerTickerItems: PartnerTickerItemProp[] = wpContent.map((partner: PartnersTickerItemFields) => ({
		name: partner.name ?? '',
		brandImg: partner?.brandImg?.node?.sourceUrl ?? onImageError('missing brand image in partner ticker').src,
		link: partner.link ?? '',
		title: partner.title ?? '',
	}));

	return { partnerTickerItems };
}

const { partnerTickerItems } = Astro.props;
---

<section class='partners-ticker hidden lg:block' aria-label='Our Partners'>
	<ul class='partner-logo-container' role='list'>
		{
			partnerTickerItems &&
				partnerTickerItems.map((partner) => (
					<li class='__item'>
						<a href={partner?.link} rel='noopener noreferrer' target='_blank' class='focus:outline-none focus:ring-2 focus:ring-primary-blue-2'>
							<Image loading='lazy' decoding='async' format='svg' src={partner.brandImg} alt={`${partner?.title} logo`} height={150} width={250} />
						</a>
					</li>
				))
		}
		{
			partnerTickerItems &&
				partnerTickerItems.map((partner) => (
					<li class='__item'>
						<a href={partner?.link} rel='noopener noreferrer' target='_blank' class='focus:outline-none focus:ring-2 focus:ring-primary-blue-2'>
							<Image loading='lazy' decoding='async' format='svg' src={partner.brandImg} alt={`${partner?.title} logo`} height={150} width={250} />
						</a>
					</li>
				))
		}
		{
			partnerTickerItems &&
				partnerTickerItems?.map((partner) => (
					<li class='__item'>
						<a href={partner?.link} rel='noopener noreferrer' target='_blank' class='focus:outline-none focus:ring-2 focus:ring-primary-blue-2'>
							<Image loading='lazy' decoding='async' format='svg' src={partner.brandImg} alt={`${partner?.title} logo`} height={150} width={250} />
						</a>
					</li>
				))
		}
		{
			partnerTickerItems &&
				partnerTickerItems?.map((partner) => (
					<li class='__item'>
						<a href={partner?.link} rel='noopener noreferrer' target='_blank' class='focus:outline-none focus:ring-2 focus:ring-primary-blue-2'>
							<Image loading='lazy' decoding='async' format='svg' src={partner.brandImg} alt={`${partner?.title} logo`} height={150} width={250} />
						</a>
					</li>
				))
		}
	</ul>

	<div class='fade'></div>
</section>

<style>
	.partners-ticker {
		position: relative;
		margin: 0 auto;
		white-space: nowrap;
		width: 100%;
		height: min-content;
		overflow: hidden;
	}

	.partner-logo-container:hover {
		animation-play-state: paused;
	}

	.partner-logo-container {
		margin: auto;
		width: 100%;
		display: inline-flex;
		align-items: center;
		flex-direction: row;
		height: min-content;
		white-space: nowrap;
		box-sizing: content-box;
		-webkit-animation-iteration-count: infinite;
		animation-iteration-count: infinite;
		-webkit-animation-timing-function: linear;
		animation-timing-function: linear;
		-webkit-animation-name: ticker;
		animation-name: ticker;
		-webkit-animation-duration: 300s;
		animation-duration: 300s;
	}

	.__item {
		margin: 1rem 0rem 1rem 2rem;
		height: min-content;
		img {
			max-width: 75px;
			max-height: 75px;
			aspect-ratio: auto;
		}

		@media screen and (min-width: 768px) {
			img {
				max-width: 125px;
				max-height: 125px;
				aspect-ratio: auto;
			}
		}
	}

	.fade {
		width: 100%;
		top: 0;
		bottom: 0;
		position: absolute;
		background: linear-gradient(90deg, #00000050, transparent 3%, transparent 97%, #00000093);
		pointer-events: none;
	}

	@keyframes ticker {
		0% {
			-webkit-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
			visibility: visible;
		}

		100% {
			-webkit-transform: translate3d(-10200px, 0, 0);
			transform: translate3d(-10200px, 0, 0);
		}
	}

	@-webkit-keyframes ticker {
		0% {
			-webkit-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
			visibility: visible;
		}

		100% {
			-webkit-transform: translate3d(-5100px, 0, 0);
			transform: translate3d(-5100px, 0, 0);
		}
	}
</style>
